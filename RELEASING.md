# Releasing SARAUDIO

This document describes the automated release process for SARAUDIO packages.

## Prerequisites

1. **NPM_TOKEN**: Set in GitHub repository secrets for automated publishing
2. **Clean working directory**: Ensure all changes are committed to `main` branch

## Automated Release Process

Releases are fully automated via GitHub Actions. The workflow:

1. **Create a changeset** describing your changes
2. **Merge to main** - Changesets bot creates/updates "Version Packages" PR
3. **Merge the PR** - GitHub Actions will automatically:
   - Publish to npm with `latest` tag
   - Create git tags (e.g., `v0.0.2`)
   - Create GitHub Releases (via changesets/action)

### Step-by-step

```bash
# 1. Create a changeset for your changes
pnpm changeset

# 2. Commit and push
git add .
git commit -m "feat(core): add new feature"
git push origin main

# 3. Wait for "Version Packages" PR to be created/updated
# 4. Review and merge the PR
# 5. GitHub Actions will automatically publish to npm and create GitHub release
```

## Package Configuration

All published packages should have:

1. `"publishConfig": { "access": "public" }` in package.json
2. Proper `.npmignore` to exclude source files
3. `"files"` field listing what to include

## Versioning Strategy (Hybrid)

- Platform group (keeps MAJOR in sync):
  - `@saraudio/core`, `@saraudio/utils`, `@saraudio/runtime-base`, `@saraudio/runtime-browser`, `@saraudio/vue`.
  - Any breaking change here → coordinated MAJOR bump for the whole group.
- Providers and stages (independent):
  - `@saraudio/deepgram`, `@saraudio/vad-energy`, `@saraudio/meter`, etc.
  - Minor/Patch release independently; MAJOR only when required by a new core MAJOR.
  
Semver:
- Major for breaking change.
- Minor for backward-compatible features.
- Patch for fixes.

## GitHub Release Format

Releases use Angular-style grouped format with commit tables:

```
### core
| Commit | Description |
| -- | -- |
| ![fix - abc1234](badge) | Description of change |
```

Automatically generated by the official Changesets GitHub Action.

## Manual Publishing (if needed)

If you need to publish manually:

```bash
# Publish to npm
pnpm changeset publish

# Push tags
git push --follow-tags
```

## Troubleshooting

### "Version Packages" PR not created
- Check GitHub Actions permissions: Settings → Actions → General
- Ensure "Allow GitHub Actions to create and approve pull requests" is enabled
- Verify NPM_TOKEN is set in repository secrets

### Release troubleshooting
- If Releases don’t appear, verify the Release workflow ran on `main` and that `changesets/action` step output shows `published: true`.
- Check that CHANGELOGs are properly formatted
- Ensure all packages have matching versions
