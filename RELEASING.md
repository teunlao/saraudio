# Releasing SARAUDIO

This document describes the automated release process for SARAUDIO packages.

## Prerequisites

1. **NPM_TOKEN**: Set in GitHub repository secrets for automated publishing
2. **Clean working directory**: Ensure all changes are committed to `main` branch

## Automated Release Process

Releases are fully automated via GitHub Actions. The workflow:

1. **Create a changeset** describing your changes
2. **Merge to main** - Changesets bot creates/updates "Version Packages" PR
3. **Merge the PR** - Packages are automatically:
   - Published to npm with `latest` tag
   - Tagged in git (e.g., `v0.0.2`)
   - Released on GitHub with grouped commit tables

### Step-by-step

```bash
# 1. Create a changeset for your changes
pnpm changeset

# 2. Commit and push
git add .
git commit -m "feat(core): add new feature"
git push origin main

# 3. Wait for "Version Packages" PR to be created/updated
# 4. Review and merge the PR
# 5. GitHub Actions will automatically publish to npm and create GitHub release
```

## Package Configuration

All packages should have:

1. `"publishConfig": { "access": "public" }` in package.json
2. Proper `.npmignore` to exclude source files
3. `"files"` field listing what to include

## Versioning Strategy

- All `@saraudio/*` packages are versioned together (linked versioning)
- Major version for breaking changes
- Minor version for new features
- Patch version for bug fixes

## GitHub Release Format

Releases use Angular-style grouped format with commit tables:

```
### core
| Commit | Description |
| -- | -- |
| ![fix - abc1234](badge) | Description of change |
```

Generated by `scripts/create-github-release.mts` which:
- Parses CHANGELOGs for all packages
- Filters duplicate commits (common in linked versioning)
- Creates commit tables with type badges
- Links to commit hashes on GitHub

## Manual Publishing (if needed)

If you need to publish manually:

```bash
# Publish to npm
pnpm changeset publish

# Create GitHub release
node scripts/create-github-release.mts

# Push tags
git push --follow-tags
```

## Troubleshooting

### "Version Packages" PR not created
- Check GitHub Actions permissions: Settings → Actions → General
- Ensure "Allow GitHub Actions to create and approve pull requests" is enabled
- Verify NPM_TOKEN is set in repository secrets

### Release script fails
- Run with `--dry-run` to debug: `node scripts/create-github-release.mts --dry-run`
- Check that CHANGELOGs are properly formatted
- Ensure all packages have matching versions